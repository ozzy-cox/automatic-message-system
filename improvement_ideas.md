1. Added tests only check the requried behavior from the document.
2. Using batching when writing update states to DB should be added.
3. Postgres is not the best database for storing messages.
